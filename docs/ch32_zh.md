第 32章应用程序框架是实现细节
.
I — — --- ----------------------- _
应用程序框架现在非常流行, 
效，非常有用，而且是免费的“
在通常情况［、足-件好車。许多框架都非常有
框架作者
大部分善架的作者愿意免费提供自己的工作成果，是因为他们想要帮助整个社 
群，想要回馈社会。这值得鼓励，但不管这些作者的动机有多么高尚，恐怕也并没 
有提供针对你个人的最佳方案。即使他们想，也做不到，因为他们并不了解你，也 
不了解你遇到的问题。
这些框架作者所了解的都是他们自己遇到的问题，可能还包括亲戚朋友所遇到 
的。他们创造框架的目的是解决这些问题—— 而不是解决你遇到的问题。
当然，你所遇到的问题可能和其他人遇到的大体上一致。如果不是这样，框架 
也就不会那么流行了。正是由于这种重合性的存在，框架才这么有用。
单向婚姻
我们与框架作者之间的关系是非常不对等的。我们要采用某个框架就意味着口 
己要遵守一大堆约定，但框架作者却完全不需要为我们遵守什么约定。
请仔细想想这-关系，当我们决定采用一个框架时’就需要完整地阅读框架作 
者护徉的文芾在这个文档中，框架作者和框架其他用户对我们提出进行应用整合 
w H S * 框架作者还会不停地催促我们将应用与框架结合得越 紧密越好。
, 亠皿岸右心的框架耦合是没有风险的。毕竟作为作者’
对框架作者来说，丿业用程仔T 目 "
253架构整洁之道
他们对框架有绝对的控制权，强耦合是应该的°
与此同时，惟者当然是卡常希望让我们的应用与其框架紧密结合的,因为这意 
味着脱离框架会很困堆o 作为II1架竹:昔来说,没有什么比止—堆用户心甘情愿地基 
于他的框架基类来构建派生类更自豪的事情了。
换句话说，框架作者想让我们与框架订终专—一这相当丁我们要对他们的框架 
做一个巨大而长期的承诺，而在任何情况下框架作者都不会对我们做出同样的承z 这种婚姻是单向的。我们要承担所有的风险，而框架作者则没有任何风险。
风险
那么我们要承担的风险究竟有哪些呢？我们可以想到的至少有以下这几项:
• 框架自身的架构设计很多时候并不是特别正确的。框架本身可能经常违反依 
赖关系原则。譬如，框架可能会要求我们将代码引入到业务对象中—— 甚至 
是业务实体中。框架可能会想要我们将框架耦合在最内圈代码中。而我们一 
旦引入，就再也不会离开该框架了，这就像戴上结婚戒指一样，从此一生不 
离不弃了。
• 框架可能会帮助我们实现一些应用程序的早期功能，但随着产品的成熟，功
能要求很可能超出框架所能提供的范围。而且随着时间的推移，我们也会发
现在应用的开发过程中，自己与框架斗争的时间要比框架帮助我们的时间长
得多。
框架本身可能朝着我们不需要的方向演进。也许我们会被迫升级到一个并不 
需要的新版本，甚至会发现自己之前所使用的旧功能突然消失了，或悄悄改 
变了行为。
未来我们可能会想要切换到一个更新、更好的框架上。第 32章应用程序框架是实现细节
解决方案
解决方案是什么呢?
请不要嫁给框架
我们可以使用框架一但要时刻警惕，别被它拖住。 
最外圈的一个实现细节来使用，不要让它们进入内圈。
■ ■
我们应该将框架作为架构
如果框架要求我们根据它们的基类来创建派生类，就请不要这样做！我们可以
创造一些代理类, 同时把911这些代理类当作业务逻辑的插件来管理。
另外，不要让框架污染我们的核心代码，应该依据依赖关系原则，将它们当作 
核心代码的插件来管理。
以 Spring为例，它作为一个依赖注入框架是不错的，也许我们会需要用Spnng 来自动连接应用程序中的各种依赖关系。这不要紧，但是千万别在业务对象里到处 
写@n to w ir e d 注解。业务对象应该对Spring完全不知情才对。
反之，我们也可以利用Spring将依赖关系注入到Main组件中，毕竟Main组 件作为系统架构中最低层、依赖最多的组件，它依赖于Spring并不是问题。
不得不接受的依赖
有-些框架是避免不了使用的。例 如 如 果 驚 £ 舊 囂 爲 
免使用的。如 果 你 在 用 加 ，那么标准类库也是不太可館避免使用的。
杯 F當 一 （日这仍然应该是你主动选择的结果。你必须明白’如果一旦在项 
疋 很 吊 一 値 右 - 「冷幣个牛命周期中都婪依赖于它’不管后来情形怎么 
目中引入-个框架，电 聲 籃 需 该 草 率 地 做 出 决 定 。
变化，这个决定都很难更改1 。内此’
255•―二
本章小结
总而言之。当我们面临框架选择时，尽量不要草率地做出决定。在全身心投入 
之前，应该首先看看是否可以部分地采用以增加了解。月外’倩尽可能长时间地将 
框架留在架构边界之外，越久越好。因为谁知道呢，也许你可以不用买奶牛也能喝 
到牛奶I。
1 美国俚语，意思是既然可以貞接达到目的就不必绕弯路。
译者注