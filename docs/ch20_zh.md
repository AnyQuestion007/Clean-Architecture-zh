第 20 章 业务逻辑

如 果 我 们 要 将 自 訓 酗 冋 分 常 时 插 件 两部分’就必须 更 倾 
了解业务逻辑究竟是什么它到底有几 和 …
严格I ; ，业务逻辑就是程序中那些真正用于赚钱或警豐 务 讐 ■ 
刎 格 爲 • 泌 这 昨 沁 眦 心 曲 机 上 实 现 的 '丿 "人 工 执 它 们 齢 
f l 赚代匕的柞用都是一样的I
例如张行要对借贷收取碾利息这个逻辑就是银行获取收入方面的一条业务 
逻辑, 它來说，我们通过计算机来计算利息，还是让一个银行职员用计算器来计 
算利息并不重要。
我们通常称这些逻辑为“关键业务逻辑”，因为它们是一项业务的关键部分， 
不管有没有自动化系统来执行这项业务，这—点是不会改变的。
“关键业务逻辑”通常会需要处理一些数据，例如，在借贷的业务逻辑中，我们 
需要知道借贷的数量、利率以及还款日程。
我们将这些数据称为“关键业务数据”，这是因为这些数据无论自动化程序存 
在与否，都必须要存在。
m
关键业务逻辑和关键业务数据是紧密相关的，所以它们很适合被放在同一个对 
象中处理。我们将这种对象称为“业务实体(Entity) ” 1 o
1 窗这个沁概念- 书的名,字人是I曲var 山Jaco川bson版起 的；(,诸寫参爲in T ：. ；圖. 等AA 人. 合A 著的。回 。皿 畅/ " f阿 e

业务实体

业务实体实际上就是计算机系统中的一种对象，这种对象中包含了一系列用于 
操作关键数据的业务逻辑。这些实体对象要么直接包含关键业务数据，要么可以很 
容易地访问这些数据。业务实体的接口层则是由那些实现关键业务逻辑、操作关键 
业务数据的函数组成的。 - •
例如，/土图20」中,我们看到的是一个对应于借贷业务的实体类Loan的UML
图。如你所见’该类中包含了三个关键业务数据，以及三个代表了其关键业务逻辑 
的接口。
Loan
- principle - rate ・ period + makePayme nt() + applyl nterest() + chargeLateFee()
~ •・— ・■・〜— 亠. _ 一 m _ —
................... 一
图20.1：对应于借贷业务的实体类Loan的UML图
当我们创建这样一个类时，其实就是在将软件中具体实现了该关键业务的部分
聚合在一起，将其与自动化系统中我们所构建的其他部分隔离区分。这个类独自代
表了整个业务逻辑，它与数据库、用户界面、第三方框架等内容无关。该类可以在
任何一个系统中提供与其业务逻辑相关的服务' 它不会去管这个系统是如何呈现给
用户的，数据是如何存储的，或者是以何种方式运行的。总而言之，业务实体这个 
概念中应该只有业务逻辑，没有别的。
有些读者可能会担心我在这里把业务实体解释成一个类。不是这样的，业务实
体不一定非要用面向对象编程语言的类来实现。业务实体这个概念只要求我们将关

用例

111
定义或限制自
计的业务逻辑是，银行职员必狈自尢啊乐、 
值在500以上，然后才允许向用户提供借 
在设计其计算机系统时确保两件事：首先' 
息并且让其通过相关验证；其次，客户只;
款预估页。
我们在上面所描述的就是-个用例（心 曲 ）» 用例本质上就是关于如何操 
作-个自动化系统的描述，它定义了用户需要提供的输入数据、、用户应该得到的输 
出信息以及产生输岀所应该采取的处理步骤。当然，用例所描述的是某种特定应用 
情景下的业务逻辑，它并非业务实体中所包含的关键业务逻辑。
下面，让我们来看看图20.2中的这个用例。请注意，图 20.2的最后一行中提到 
的 “客户”，这里的客户是指代表客户的业务实体，其中包含了处理银行与客户之 
间关系的关键业务逻辑。
为新贷款收集联系信息
输入：名字、地址、生日、驾照号码或社会安全 
号码等。
输出：显示所输入的信息以供确认，并且包括信 
用值。
主要步骤：
1. 接受并且校验名字。
2. 校验地址、生日、驾照号码、社会安全号码 
等O
3. 获取客户的信用值。
4. 如果信用值小于500,则跳转到拒绝页。
5・否则，创建客户对象，并且跳转至$还款预估页。
图 20.2：用例示范
如上所示，用例中包含了对如何调用业？ 
言之，用例控制着业务实体之间的交互方式。
除此Z 外，这里还应该注意，用例除非正式地描述了数据流入/流出接口以外,
I I I
■ ■
1 我们之前已经介绍过了。
170
■■第 20章业务逻辑
如果我们只看用例,是没有办法分辨岀系统是 
杲种常客门端;或后是以命令行模式交付的,还
并不详细描述用户界而。也就是说, 
在Web平台上交付的，还是交付了 是以一个内部服务模式交付的o
些特「甞 ］讪 爲
m；：； ： ；；；；需 鳥 业 二 : 囂 ； 式，匕与数据流入/流出系统的方式无关C 
在我们的系统中，用例本身也是一个对象，该对象中包含了一个或多个实现了 
特定应用情景的业务逻辑函数。当然除此之外，用例对象中也包含了输入数据、输 
出数据以及相关业务实体的引用，以方便调用。
当然，业务实体并不会知道是哪个业务用例在控制它们，这也是依赖反转原则 
' DIP）的另一个应用情景。也就是像业务实体这样的高层概念是无须了解像用例这 
样的低层概念的。反之，低层的业务用例却需要了解高层的业务实体。
那么，为什么业务实体属于高层概念，而用例属于低层概念呢？因为用例咨応 
的是一个特定的应用情景，这样一来，用例必然会更靠近系统的输入和输出。而业 
务实体是一个可以适用于多个应用情景的一般化概念，相对地离系统的输入和输出 
更远。所以，用例依赖于业务实体，而业务实体并不依赖于用例。

请求和响应模型

在通常情况下，用例会接收输入数据，并产生输出数据。但在一个设计良好的 
架构中，用例对象通常不应该知道数据展现给用户或者其他组件的方式。很兄浓. 
我们当然不会希望这些用例类中的代码出现"M L 和SQL。
因此，用例类所接收的输入应该是一个简单的请求性数据林1応回输出的 
应该是一个简单的响应性数据结构。这些数据结构中不应该存在任何依赖关t 匕 一和什“ Response这样的标准框架接口。这些数据 
们并不派生自 H ttpR equest 和 H ttpRespons：：：
接口应该与Web无关，也不应该了解任何有关用尸界面的细巾。架构整洁之道
这种独立性非常关键，如果这里的请和m 鶯 完 全 独 立 的’那么騎 k 些模型的用例就会依赖于这些模型所带来的 < 人 八
可 能 側 林 会 选 样 直 財 数据结构川仲呼 蹩 : 驚 豐 2 用［毕竟，业 
青求响应模型之间有很多相同的数据。但 , 定 、一 八 宓两个对象
主的意义是非常、非常不-样的。随着时间的推移，这两个对象会以不同的原因、 
不同的速率发生变更。所以将它们以任何方式整合在1 起都是对共同闭包原则 
CCP)和单一职责原则(SRP)的违反。这样做的后果，往往会导致代码中出现 
很多分支判断语句和中间数据。

本章小结

业务逻辑是一个软件系统存在的意义，它们属于核心功能，是系统用来赚钱或 
省钱的那部分代码，是整个系统中的皇冠明珠。
这些业务逻辑应该保持纯净，不要掺杂用户界面或者所使用的数据库相关的东 
西。在理想情况下，这部分代表业务逻辑的代码应该是整个系统的核心，其他低层 
概念的实现应该以插件形式接入系统中。业务逻辑应该是系统中最独立、复用性最 
高的代码。 ’