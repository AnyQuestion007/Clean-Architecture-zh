第21章
尖叫的软件架构架构整洁之道
j某个建筑的设［I架构图，那么在这I 反映J「筑设计师精 究竟应该冻怎样的架构图呢？
，那么我们彳艮可*先看到一彳大门，然 
「，同II打J能还会看到一个餐厅［接着，距肉餐厅不j. :厨房附近还会有—个非正式用餐区，或_个亲子房。当 
，应该不会怀疑这是一个单户住宅。几乎幣个建筑设计都在
假设我们现在正在査看
心设计成果的文件中,--
如果这是0 幅单户住宅的建筑架构I團 
后是■条连接到越*室的通斗 
处应该会有一个厨房，可能 
我们阅读这个架构图时： 
尖叫着告诉你：这是一个“家”。
假设我们阅读的是一幅图书馆的建筑设计图，情况也差不多。我们应该会先看 
到一个超大入口，然后是一个用于签到/签岀的办公区，接下来是阅读区、小型会议 
室，以及一排排的书架区。同样，几乎整个建筑设计都在尖叫着跟你说：这是一个 
“图书馆”。
那么，我们的应用程序的架构设计又会“喊”些什么呢？当我们查看它的顶层 
结构目录，以及顶层软件包中的源代码时，它们究竟是在喊“健康管理系统”“账 
务系统” “库存管理系统”，还是在喊： “Rails” " Spring/Hibemate" “ASP” 这 
样的技术名词呢？
架构设计的主题
在这里，再次推荐读者仔细阅读Ivar Jacobson关于软件架构设计的那本书： Object Oriented Software Engineering,请读者注意这本书的副标题胡 U s e C a se Driven 伽 曲 （业务用例驱动的设计方式）o 在这本书中，Jacobson提出了-个观点： 车人件的系统架构应该为该系统的用例提供支持。这就像住宅和图书馆的建筑计划满 
篇都在非常明显地凸显这些建筑的用例-样，软件系统的架构设计图也应该非常明 
确地凸显该应用程序会有哪些用例0
■ 构 幣 鬣 豐 兽 与 框 架 相 关 的 ，这件事不应该是基于框架来 
的内容。如果我们的架构是基于框架来设计的，它 就 不 能 :于 :爲 例 囂 计 了 。
174
-具 以 鳥 囂 囂 鳥 豊 u 川例來展爪这样的架构设计可以在［离■ ］、 兒的怙况卜兀整地描述用例。这就好像—个住宅建筋设计的首要目
囂 鶯 豔 需 需 讐 囂 而 不 是 确 保 一 定 要 呗 来 构 题 个 房 子 。架构师应 
囂 由 地 选 ;建 筑 黑 豐 駕 陰 需 需 要 的 情 "尽 可 能 地 允 许 用 户
而月•'良好的架构设计应该尽可能地允许用户推迟和延后决定釆用什么框架、 
数据库、Web服务以及其他与环境相关的工具。框架应该是一个可选项，良好的架 
构计计应该允许用户在项目后期再决定是否采用Rails、Spring> Hibernate> Tomcat、 
MySQL这些工具。同时，良好的架构设计还应该让我们很容易改变这些决定。总之， 
良好的架构设计应该只关注用例，并能将它们与其他的周边因素隔离。
那Web呢
Web究竟是不是一种架构？如果我们的系统需要以Web形式来交付，这是否意 味着我们只能采用某种系统架构？当然不是！ Web只是一种交付手段一一一种10设 备—— 这就是它在应用程序的架构设计中的角色。换句话说，应用程序采用Web方 式来交付只是一个实现细节，这不应该主导整个项目的结构设计。事实上，关于一 
个应用程序是否应该以Web形式来交付这件事，它本身就应该是一个被推迟和延后 
的决策。一个系统应该尽量保持它与交付方式之间的无关性。在不更改基础架构设 
计的情况下，我们应该可以将一个应用程序交付成命令行程序、Web程序、富客户 
端程序、Web服务程序等任何一种形式的程序。
框架是工具而不是生活信条
当 然 ,框 架 通 常 可 以 是 非 常 弩 的 ;篇 囂 的 般 ;;:池 囂 囂 ;囂 眾 
框架有着极深的信念，他们所写出来的使用手册般架构整洁之道
、•“ 如的。甚至这些框架的使用者所写的教程也純 
信徒的角度来描绘如何°w ：个机架是能包揽_切、超越一切、解决-如; 现 这 种 好 申 代 。他们知"卜你木M 1
题的存在。
这不应该成为你的观点。 ________
我 们 -定 要 带 丫 不 鸞 态 豐 需 衡 如 何 使 用一个框架，如何保护自己。无 
囂 黑 囂 2 爲 購 如 囂 囂 对 系 统用例的关注‘避 免 让 幘 主 导 毗 
架构设计。
一个框架。是的，采用框架可能会很有帮助，
可测试的架构设计
如果系统架构的所有设计都是围绕着用例来展开的，并且在使用框架的问题上 
保持谨慎的态度，那么我们就应该可以在不依赖任何框架的情况下针对这些用例进 
行单元测试。另外，我们在运行测试的时候不应该运行Web服务，也不应该需要连 接数据库。我们测试的应该只是一个简单的业务实体对象，没有任何与框架、数据 
库相关的依赖关系。总而言之，我们应该通过用例对象来调度业务实体对象，确保 
所有的测试都不需要依赖框架。
本章小结
一个系统的架构应该着重于展示系统本身的设计，而并非该系统所使用的框熱 
如果我们要构建的是一个医疗系统，新来的程序员第_次看到其源码时就应该知道 
赵是-个阪疗系统。新来的程序员应该先了解该系统的用例，而非系统的交付方式。 
他们口 J能会走过来问你：
"我看到了-些看起来像是模型的代码— 但它们的视图和控制器在哪里？” 
这时你的回答应该是：
回头再来决定应该怎么做。”